<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breath Buddy - 腹式呼吸練習</title>
    <style>
        /* --- CSS 變數與基本設定 --- */
        :root {
            --ease-in-out-quad: cubic-bezier(0.455, 0.03, 0.515, 0.955);
            --duration-inhale: 4s;
            --duration-exhale: 4s;
            
            /* 色彩配置 */
            --color-bg-start: #fde2e4;
            --color-bg-end: #dceefb;
            --color-circle-start: #a2d2ff;
            --color-circle-end: #ffc8dd;
            --color-text-primary: #575757;
            --color-text-secondary: #f0f8ff;
            --color-button-bg: rgba(255, 255, 255, 0.7);
            --color-button-hover-bg: white;
            --color-shadow: rgba(0, 0, 0, 0.1);
            --color-focus-ring: #a2d2ff;
        }

        /* --- 全域樣式 --- */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--color-bg-start), var(--color-bg-end));
            color: var(--color-text-primary);
            text-align: center;
            padding: 1rem;
            transition: background 0.5s;
        }

        /* --- 主要版面與容器 --- */
        .app-container {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        
        /* --- 標題與說明 --- */
        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            letter-spacing: 0.1em;
        }
        
        .header p {
            font-size: 1rem;
            font-weight: 400;
            color: var(--color-text-primary);
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        /* --- 呼吸引導圈 --- */
        .breathing-circle-container {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .breathing-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-circle-start), var(--color-circle-end));
            box-shadow: 0 10px 30px var(--color-shadow);
            transform: scale(0.5); /* 初始大小 */
            transition: transform var(--ease-in-out-quad);
        }
        
        /* 狀態 class 控制圓圈大小 */
        .breathing-circle.state-inhale,
        .breathing-circle.state-hold {
            transform: scale(1);
            transition-duration: var(--duration-inhale);
        }
        
        .breathing-circle.state-exhale {
            transform: scale(0.5);
            transition-duration: var(--duration-exhale);
        }

        .circle-text-content {
            position: absolute;
            color: var(--color-text-secondary);
            z-index: 10;
        }

        .phase-text {
            font-size: 1.75rem;
            font-weight: 300;
        }
        
        .phase-countdown {
            font-size: 3.5rem;
            font-weight: 200;
            line-height: 1;
        }
        
        /* --- 倒數計時 --- */
        .total-countdown-container {
            font-size: 1rem;
            opacity: 0.7;
        }

        .total-countdown-container span {
            font-weight: 600;
        }
        
        /* --- 控制按鈕 --- */
        .controls {
            display: flex;
            gap: 1rem;
        }
        
        .control-button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            background-color: var(--color-button-bg);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--color-shadow);
            backdrop-filter: blur(10px);
            transition: background-color 0.3s, transform 0.2s;
            color: var(--color-text-primary);
            font-weight: 500;
        }
        
        .control-button:hover {
            background-color: var(--color-button-hover-bg);
            transform: translateY(-2px);
        }

        .control-button:focus-visible {
            outline: 2px solid var(--color-focus-ring);
            outline-offset: 2px;
        }

        /* --- 完成畫面 --- */
        .completion-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        
        .encouragement-message {
            font-size: 1.5rem;
            font-weight: 500;
            color: transparent;
            background-image: linear-gradient(135deg, #6e8efb, #a777e3);
            background-clip: text;
            -webkit-background-clip: text;
            min-height: 2.25rem; /* 避免文字切換時跳動 */
        }
        
        /* --- 輔助 & 狀態 --- */
        .hidden {
            display: none !important;
        }

        /* --- 無障礙 & 響應式 --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        @media (prefers-reduced-motion: reduce) {
            .breathing-circle {
                transition: none;
            }
            .control-button:hover {
                transform: none;
            }
        }
        
        @media (max-width: 360px) {
            .header h1 {
                font-size: 2rem;
            }
            .breathing-circle-container {
                width: 180px;
                height: 180px;
            }
            .phase-text {
                font-size: 1.5rem;
            }
            .phase-countdown {
                font-size: 3rem;
            }
        }

    </style>
</head>
<body>

    <main class="app-container">
        
        <!-- 標題區塊 -->
        <header class="header">
            <h1>Breath Buddy</h1>
            <p>跟隨圓圈，進行 4-4-4 節奏的腹式呼吸練習。</p>
        </header>
        
        <!-- 練習主畫面 -->
        <div id="exercise-view">
            <!-- 呼吸圓圈與內部文字 -->
            <div class="breathing-circle-container">
                <div id="breathing-circle" class="breathing-circle"></div>
                <div class="circle-text-content">
                    <p id="phase-text" class="phase-text">準備</p>
                    <p id="phase-countdown" class="phase-countdown">4</p>
                </div>
            </div>
            
            <!-- 總倒數 -->
            <div class="total-countdown-container">
                總時長: <span id="total-countdown">60</span> 秒
            </div>
        </div>
        
        <!-- 完成畫面 -->
        <div id="completion-view" class="completion-screen hidden">
            <p class="encouragement-message" id="encouragement-message">做得很好！</p>
            <button id="try-again-button" class="control-button" aria-label="再來一次，重新開始60秒呼吸練習">再來一次</button>
        </div>
        
        <!-- 控制按鈕 -->
        <div id="controls-view" class="controls">
            <button id="start-pause-button" class="control-button" aria-label="開始練習">開始</button>
            <button id="reset-button" class="control-button" aria-label="重置練習">重置</button>
        </div>

        <!-- 螢幕閱讀器專用的即時更新區域 -->
        <div id="a11y-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- DOM 元素 ---
        const breathingCircle = document.getElementById('breathing-circle');
        const phaseText = document.getElementById('phase-text');
        const phaseCountdown = document.getElementById('phase-countdown');
        const totalCountdown = document.getElementById('total-countdown');
        const startPauseButton = document.getElementById('start-pause-button');
        const resetButton = document.getElementById('reset-button');
        const tryAgainButton = document.getElementById('try-again-button');
        const exerciseView = document.getElementById('exercise-view');
        const completionView = document.getElementById('completion-view');
        const controlsView = document.getElementById('controls-view');
        const encouragementMessage = document.getElementById('encouragement-message');
        const a11yLiveRegion = document.getElementById('a11y-live-region');

        // --- 常數設定 ---
        const PHASES = [
            { name: '吸氣', duration: 4, stateClass: 'state-inhale' },
            { name: '屏息', duration: 4, stateClass: 'state-hold' },
            { name: '呼氣', duration: 4, stateClass: 'state-exhale' },
        ];
        const TOTAL_EXERCISE_TIME = 60; // 總練習時間（秒）
        const CYCLE_DURATION = PHASES.reduce((sum, phase) => sum + phase.duration, 0);

        const ENCOURAGEMENT_MESSAGES = [
            "做得很好！", "謝謝你給自己這段時間。", "你的專注很珍貴。", "深呼吸讓你更清晰。", 
            "你值得這份平靜。", "太棒了，繼續保持。", "今天你已經完成了一件重要的事。", 
            "安靜的力量正在滋養你。", "很好，你正在訓練自己的控制力。", "呼吸帶你回到當下。",
            "你的努力正在累積。", "做得真好，身心都更放鬆了。", "這一分鐘，你屬於自己。", 
            "你正在慢慢變得更穩定。", "平靜正在你的心裡生根。", "太好了，你已經堅持到了最後。",
            "你的專注令人敬佩。", "這是送給自己的禮物。", "深呼吸，力量就在你心中。", 
            "每一次練習都讓你更進步。", "你正在好好照顧自己。", "謝謝你給自己這份溫柔。", 
            "平穩的呼吸讓你更堅定。", "很棒，你完成了一次完整的練習。", "你的耐心是最美的力量。", 
            "這份寧靜會陪你一整天。", "做得真好，你值得驕傲。", "每一次呼吸都讓你更有能量。", 
            "謝謝自己今天的付出。", "你正在成為更專注、更自在的自己。"
        ];

        // --- 狀態變數 ---
        let appState = 'idle'; // 'idle', 'running', 'paused', 'finished'
        let mainInterval = null;
        let totalTimeRemaining = TOTAL_EXERCISE_TIME;
        let currentPhaseIndex = 0;
        let timeInPhase = 0;
        
        // --- 核心函式 ---

        /**
         * 初始化或重置應用程式狀態與 UI
         */
        function reset() {
            clearInterval(mainInterval);
            mainInterval = null;
            
            appState = 'idle';
            totalTimeRemaining = TOTAL_EXERCISE_TIME;
            currentPhaseIndex = 0;
            timeInPhase = 0;
            
            updateUI();
            
            // 切換畫面可見度
            exerciseView.classList.remove('hidden');
            completionView.classList.add('hidden');
            controlsView.classList.remove('hidden');

            // 確保圓圈回到初始狀態
            breathingCircle.className = 'breathing-circle';
            // 手動觸發一次重排，確保 class 被移除後再添加
            void breathingCircle.offsetWidth; 
        }

        /**
         * 處理開始/暫停/繼續按鈕的點擊事件
         */
        function handleStartPause() {
            if (appState === 'running') {
                pause();
            } else {
                start();
            }
        }

        /**
         * 開始或繼續計時器
         */
        function start() {
            if (appState === 'idle') {
                // 如果是從頭開始，立即進入第一個階段
                changePhase(0);
            }
            
            appState = 'running';
            startPauseButton.textContent = '暫停';
            startPauseButton.setAttribute('aria-label', '暫停練習');

            mainInterval = setInterval(tick, 1000);
        }

        /**
         * 暫停計時器
         */
        function pause() {
            appState = 'paused';
            clearInterval(mainInterval);
            startPauseButton.textContent = '繼續';
            startPauseButton.setAttribute('aria-label', '繼續練習');
            updateUI(); // 更新 UI 以顯示 "已暫停" 等資訊
        }
        
        /**
        * 每秒鐘執行的主要邏輯 (Tick)
        */
        function tick() {
            if (appState !== 'running') return;
            
            totalTimeRemaining--;
            timeInPhase++;
            
            const currentPhase = PHASES[currentPhaseIndex];

            // 檢查是否需要切換到下一個階段
            if (timeInPhase >= currentPhase.duration) {
                const nextPhaseIndex = (currentPhaseIndex + 1) % PHASES.length;
                changePhase(nextPhaseIndex);
            }
            
            // 檢查練習是否結束
            if (totalTimeRemaining <= 0) {
                finish();
            }
            
            updateUI();
        }

        /**
         * 切換到指定階段
         * @param {number} phaseIndex - PHASES 陣列中的索引
         */
        function changePhase(phaseIndex) {
            currentPhaseIndex = phaseIndex;
            timeInPhase = 0;
            
            const newPhase = PHASES[currentPhaseIndex];
            
            // 更新圓圈的 CSS class 來觸發動畫
            breathingCircle.className = 'breathing-circle'; // 先重置
            // 延遲一點點時間再添加新 class，確保 CSS transition 生效
            setTimeout(() => {
                breathingCircle.classList.add(newPhase.stateClass);
            }, 10);
        }

        /**
         * 練習完成時的處理
         */
        function finish() {
            clearInterval(mainInterval);
            appState = 'finished';

            // 顯示完成畫面，隱藏練習畫面
            exerciseView.classList.add('hidden');
            controlsView.classList.add('hidden');
            completionView.classList.remove('hidden');

            // 隨機選擇並顯示鼓勵語
            const randomIndex = Math.floor(Math.random() * ENCOURAGEMENT_MESSAGES.length);
            encouragementMessage.textContent = ENCOURAGEMENT_MESSAGES[randomIndex];
            a11yLiveRegion.textContent = `練習完成。${encouragementMessage.textContent}`;
        }
        
        // --- UI 更新函式 ---

        /**
         * 根據目前狀態更新所有可視元素
         */
        function updateUI() {
            const currentPhase = PHASES[currentPhaseIndex];
            const phaseTimeLeft = currentPhase.duration - timeInPhase;
            
            if (appState === 'idle') {
                phaseText.textContent = '準備';
                phaseCountdown.textContent = PHASES[0].duration;
                totalCountdown.textContent = TOTAL_EXERCISE_TIME;
                startPauseButton.textContent = '開始';
                startPauseButton.setAttribute('aria-label', '開始練習');
            } else if (appState === 'paused') {
                phaseText.textContent = '已暫停';
                // 顯示暫停時的倒數
                phaseCountdown.textContent = phaseTimeLeft;
                totalCountdown.textContent = totalTimeRemaining;
            } else if (appState === 'running') {
                phaseText.textContent = currentPhase.name;
                phaseCountdown.textContent = phaseTimeLeft;
                totalCountdown.textContent = totalTimeRemaining;
                
                // 更新 ARIA live region 給螢幕閱讀器
                a11yLiveRegion.textContent = `${currentPhase.name}, ${phaseTimeLeft}。總時長剩餘 ${totalTimeRemaining} 秒。`;
            }
        }
        
        // --- 事件監聽器 ---
        startPauseButton.addEventListener('click', handleStartPause);
        resetButton.addEventListener('click', reset);
        tryAgainButton.addEventListener('click', reset);
        
        // --- 初始執行 ---
        reset(); // 頁面載入時先初始化一次

    });
    </script>
</body>
</html>
